name: CI

on: [push, pull_request, workflow_dispatch]

jobs:
  stable_build:
    name: Stable Zig Compile and run Tests
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ windows-2022, macos-latest, ubuntu-latest ]

    steps:
        - uses: actions/checkout@v3
        - uses: mlugg/setup-zig@v1
          with:
            version: 0.13.0
        - name: Display Zig version
          run: zig version
        - name: Build and test
          run: zig build test --summary all

  nightly_build:
    name: Nightly Zig Compile and run Tests
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-2022]
    continue-on-error: true

    steps:
        - uses: actions/checkout@v3
        - uses: mlugg/setup-zig@v1
          with:
            version: master
        - name: Display Zig version
          run: zig version
        - name: Check Nightly build and test
          run: |
          echo "Check Nightly build and test"
          zig build test --summary all || echo "Nightly build failed."
        - name: Force Success
          if: always()  # This step runs regardless of previous step success/failure
          run: exit 0